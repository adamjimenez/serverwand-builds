"use strict";(self["webpackChunkServerWand"]=self["webpackChunkServerWand"]||[]).push([[2693],{37428:function(t,a,e){e.d(a,{Z:function(){return c}});var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("span",{ref:"container"},[t.text?e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(a){var i=a.on;return[e("span",t._g({on:{click:function(a){return t.copy(t.val)},mouseleave:function(a){return t.resetCopyText()}}},i),[t._v(" "+t._s(t.val)+" ")])]}}],null,!1,276876146)},[e("span",[t._v(t._s(t.copyText))])]):e("v-tooltip",{attrs:{top:""},scopedSlots:t._u([{key:"activator",fn:function(a){var i=a.on;return[e("v-btn",t._g({attrs:{icon:""},on:{click:function(a){return t.copy(t.val)},mouseleave:function(a){return t.resetCopyText()}}},i),[e("v-icon",{attrs:{small:""}},[t._v("file_copy")])],1)]}}])},[e("span",[t._v(t._s(t.copyText))])])],1)},l=[],o={props:{val:null,text:Boolean},data(){return{copyText:"Copy"}},methods:{copy(t){var a=document.createElement("textarea");this.$refs["container"].appendChild(a),a.setAttribute("id","clipboard"),a.value=t,a.select(),document.execCommand("Copy"),a.parentNode.removeChild(a),this.copyText="Copied"},resetCopyText(){var t=this;setTimeout((()=>t.copyText="Copy"),500)}}},n=o,s=e(1001),r=(0,s.Z)(n,i,l,!1,null,null,null),c=r.exports},84285:function(t,a,e){e.d(a,{Z:function(){return c}});var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("v-dialog",{attrs:{persistent:"",content:"","content-class":"centered-dialog"},model:{value:t.value,callback:function(a){t.value=a},expression:"value"}},[e("v-container",{attrs:{"fill-height":""}},[e("v-card",{attrs:{color:"primary",dark:""}},[e("v-card-text",[e("v-layout",{attrs:{row:""}},[e("i",{staticClass:"fas fa-magic fa-2x faa-horizontal animated"}),e("h2",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(t.message))])])],1)],1)],1)],1)},l=[],o={name:"Loading",data:()=>({}),props:{value:{type:Boolean,default:!1},message:{type:String,default:"Summoning..."}}},n=o,s=e(1001),r=(0,s.Z)(n,i,l,!1,null,null,null),c=r.exports},92835:function(t,a,e){e.d(a,{Z:function(){return u}});var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("Loading",{attrs:{value:t.loading}}),e("v-dialog",{model:{value:t.authRequired,callback:function(a){t.authRequired=a},expression:"authRequired"}},[e("v-card",[e("v-card-title",[t._v(" Auth required ")]),e("v-card-text",[e("v-btn",{on:{click:function(a){return t.authPrompt()}}},[t._v(" Continue ")])],1)],1)],1)],1)},l=[],o=e(4296),n=e(84285),s={components:{Loading:n.Z},name:"Site",data:()=>({loading:!1,newWindow:!1,provider:"linode",authRequired:!1}),methods:{create(t){var a=this;this.loading=!0,o.Z.post("sites/create",t).then((e=>{if(e.data.site_id)a.$eventHub.emit("itemsChanged"),a.$router.push("/sites/"+e.data.site_id+"/summary");else if(e.data.error)if("auth"===e.data.error){a.provider=e.data.provider,a.authRequired=!0;var i=setInterval((()=>{if(a.newWindow&&a.newWindow.closed)return a.newWindow=null,clearInterval(i),void a.create(t)}),500)}else a.$emit("error",e.data.error)})).catch((t=>console.log(t))).finally((()=>a.loading=!1))},authPrompt(){this.authRequired=!1,this.newWindow=window.open("https://serverwand.com/account/services/"+this.provider)}}},r=s,c=e(1001),d=(0,c.Z)(r,i,l,!1,null,null,null),u=d.exports},92693:function(t,a,e){e.r(a),e.d(a,{default:function(){return v}});var i=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[t.error?e("v-alert",{attrs:{type:"error"}},[t._v(" "+t._s(t.error)+" ")]):t._e(),!1===t.data.app.public_dir_exists?e("v-alert",{attrs:{type:"error"}},[t._v(" Missing public dir. "),t.data.app.git_url?e("span",[t._v(" Add a pubic folder to your Git repository and re-pull. ")]):t._e()]):t._e(),e("Loading",{attrs:{value:t.loading}}),e("v-card",{staticClass:"pa-3",attrs:{loading:t.fetching}},[t.data.origin?e("v-layout",{attrs:{row:""}},[e("v-card",[e("v-card-text",[e("v-btn",{on:{click:function(a){return t.openSync(t.data.origin)}}},[t._v(" Push ")]),e("v-btn",{on:{click:function(a){return t.openSync(t.siteId)}}},[t._v(" Pull ")])],1)],1)],1):t._e(),t.data.app?e("v-container",{staticClass:"ma-0"},[e("v-row",[t.data.app.git_url?e("v-btn",{staticClass:"mt-3",attrs:{title:"Git info"},on:{click:function(a){t.gitInfo=!0}}},[e("v-icon",[t._v("fab fa-git")])],1):t._e(),t.data.app.isNode?e("v-btn",{staticClass:"mt-3",attrs:{title:"Clear logs"},on:{click:t.clearLogs}},[e("v-icon",[t._v("block")])],1):t._e(),e("v-btn",{staticClass:"mt-3",attrs:{title:"Copy app"},on:{click:function(a){t.showCloneApp=!0}}},[e("v-icon",[t._v("mdi-content-copy")])],1),t.data.app.isNode?e("v-switch",{attrs:{label:t.data.app.status},on:{change:function(a){return t.toggleStatus()}},model:{value:t.data.app.online,callback:function(a){t.$set(t.data.app,"online",a)},expression:"data.app.online"}}):t._e()],1)],1):t._e(),t.data.app?e("div",[t.data.app.name?e("div",[e("v-card",[e("v-card-title",[t._v(" "+t._s(t.data.app.name)+" ")]),e("v-card-subtitle",[t._v(" "+t._s(t.data.app.version)+" "),t.data.app.latest&&t.data.app.latest!==t.data.app.version?e("div",[e("p",[t._v("Latest: "+t._s(t.data.app.latest))]),e("v-btn",{attrs:{color:"blue darken-1"},on:{click:function(a){return t.install(t.data.app.name)}}},[t._v("Upgrade")])],1):t._e()]),t.data.app.isNode?e("v-card-text",[e("v-textarea",{attrs:{label:"Ouput log",readonly:"",value:t.data.app.output_log}}),e("v-textarea",{attrs:{label:"Error log",readonly:"",value:t.data.app.error_log}})],1):t._e()],1)],1):e("div",[e("v-card",{staticClass:"pa-3"},[e("v-card-text",[t._v(" Unrecognised application")])],1)],1)]):e("div",[e("v-card",{staticClass:"mx-auto"},[e("v-list",[e("v-list-item-group",[t._l(t.apps,(function(a,i){return[e("v-list-item",{key:"item-"+i,attrs:{value:a},on:{click:function(e){return t.install(a.name)}}},[e("v-list-item-icon",[e("i",{class:a.icon})]),e("v-list-item-content",[e("v-list-item-title",[t._v(" "+t._s(a.label)+" ")])],1)],1)]}))],2)],1)],1)],1)],1),e("v-navigation-drawer",{attrs:{temporary:"",right:"",app:""},model:{value:t.drawer,callback:function(a){t.drawer=a},expression:"drawer"}},[e("v-card",[e("v-card-title",[t._v(" Git ")]),e("v-card-text",[e("v-text-field",{attrs:{label:"Git URL",hint:"e.g. https://github.com/<user>/<repo>.git",required:""},model:{value:t.data.git_url,callback:function(a){t.$set(t.data,"git_url",a)},expression:"data.git_url"}}),e("v-checkbox",{attrs:{label:"Clone in public dir"},model:{value:t.data.public_dir,callback:function(a){t.$set(t.data,"public_dir",a)},expression:"data.public_dir"}}),e("v-btn",{attrs:{disabled:!t.data.git_url||t.fetching,loading:t.fetching,color:"success"},on:{click:function(a){return t.submitGit()}}},[t._v(" Save ")])],1)],1)],1),e("v-dialog",{model:{value:t.showCloneApp,callback:function(a){t.showCloneApp=a},expression:"showCloneApp"}},[e("v-card",[t.error?e("v-alert",{attrs:{type:"error"}},[t._v(" "+t._s(t.error)+" ")]):t._e(),e("v-card-title",[t._v(" Clone App ")]),e("v-card-text",[e("v-text-field",{attrs:{rules:t.domainRules,label:"Staging Domain",required:""},model:{value:t.data.stagingDomain,callback:function(a){t.$set(t.data,"stagingDomain",a)},expression:"data.stagingDomain"}}),e("v-select",{attrs:{items:t.server_opts,label:"Server",required:""},model:{value:t.data.server,callback:function(a){t.$set(t.data,"server",a)},expression:"data.server"}}),e("v-checkbox",{attrs:{label:"Configure DNS",disabled:""==t.dnsProviders[t.data.server]},model:{value:t.dns,callback:function(a){t.dns=a},expression:"dns"}}),e("v-checkbox",{attrs:{label:"Realtime domain substitution in HTML",disabled:""==t.dnsProviders[t.data.server]},model:{value:t.substitutions,callback:function(a){t.substitutions=a},expression:"substitutions"}}),e("v-btn",{attrs:{color:"primary"},on:{click:t.cloneApp}},[t._v(" Save ")])],1)],1)],1),e("v-dialog",{model:{value:t.syncDialog,callback:function(a){t.syncDialog=a},expression:"syncDialog"}},[e("v-card",[t.target===t.siteId?e("v-card-title",[t._v(" Copy from live to staging ")]):e("v-card-title",[t._v(" Copy from staging to live ")]),e("v-card-text",[e("v-checkbox",{attrs:{label:"Files"},model:{value:t.files,callback:function(a){t.files=a},expression:"files"}}),e("v-checkbox",{attrs:{label:"Database"},model:{value:t.database,callback:function(a){t.database=a},expression:"database"}}),t.database?e("div",[e("v-radio-group",{staticClass:"mx-3",attrs:{row:""},model:{value:t.fullDb,callback:function(a){t.fullDb=a},expression:"fullDb"}},[e("v-radio",{attrs:{label:"Full DB",value:"1"}}),e("v-radio",{attrs:{label:"Selected tables",value:"0"}})],1),"0"==t.fullDb?e("v-card",[e("v-card-text",[e("v-row",[e("v-checkbox",{staticClass:"mx-2",attrs:{label:"Select all"},on:{click:t.selectAll},model:{value:t.allSelected,callback:function(a){t.allSelected=a},expression:"allSelected"}})],1),e("div",[e("v-row",t._l(t.tables,(function(a){return e("v-checkbox",{key:a,staticClass:"mx-2",attrs:{value:a,label:a},model:{value:t.tableNames,callback:function(a){t.tableNames=a},expression:"tableNames"}})})),1)],1)],1)],1):t._e()],1):t._e(),e("v-btn",{staticClass:"my-3",attrs:{color:"primary",disabled:!t.files&&!t.database||t.fullDb<=0&&0===t.tableNames.length},on:{click:t.sync}},[t._v(" Continue ")])],1)],1)],1),e("v-dialog",{attrs:{app:""},model:{value:t.gitInfo,callback:function(a){t.gitInfo=a},expression:"gitInfo"}},[e("v-card",{attrs:{loading:t.fetching}},[e("v-card-title",[t._v(" Git info ")]),e("v-card-text",[e("v-row",[e("v-col",[e("v-btn",{on:{click:t.gitPull}},[t._v(" Pull ")])],1)],1),e("v-row",[e("v-col",[e("v-text-field",{attrs:{label:"Git URL",readonly:""},model:{value:t.data.app.git_url,callback:function(a){t.$set(t.data.app,"git_url",a)},expression:"data.app.git_url"}})],1),e("v-col",{attrs:{cols:"1"}},[e("Copy",{attrs:{val:t.data.app.git_url}})],1)],1),e("v-row",[e("v-col",[e("v-text-field",{attrs:{label:"SSH key",hint:"Save to GitHub or Bitbucket in order to push to this repository",readonly:""},model:{value:t.data.app.ssh_key,callback:function(a){t.$set(t.data.app,"ssh_key",a)},expression:"data.app.ssh_key"}})],1),e("v-col",{attrs:{cols:"1"}},[e("Copy",{attrs:{val:t.data.app.ssh_key}})],1)],1),e("v-row",[e("v-col",[e("v-text-field",{attrs:{label:"Git Pull Webhook",hint:"Use this webhook to initiiate a Git Pull",readonly:""},model:{value:t.data.app.webhook_url,callback:function(a){t.$set(t.data.app,"webhook_url",a)},expression:"data.app.webhook_url"}})],1),e("v-col",{attrs:{cols:"1"}},[e("Copy",{attrs:{val:t.data.app.webhook_url}})],1)],1)],1)],1)],1),e("Site",{ref:"Site",on:{error:t.handleError}})],1)},l=[],o=e(4296),n=e(84285),s=e(37428),r=e(92835),c={components:{Loading:n.Z,Copy:s.Z,Site:r.Z},data:()=>({siteId:null,error:null,files:!1,database:!1,fullDb:"1",tableNames:[],tables:[],data:{server:"",origin:"",app:{}},dns:!0,substitutions:!1,dnsProviders:{},domainRules:[t=>!!t||"Domain is required"],loading:!1,fetching:!1,drawer:!1,cloneDialog:!1,syncDialog:!1,target:0,apps:[{name:"git",label:"Git repository",icon:"fab fa-git"},{name:"wordpress",label:"Wordpress",icon:"fab fa-wordpress"},{name:"joomla",label:"Joomla",icon:"fab fa-joomla"},{name:"drupal",label:"Drupal",icon:"fab fa-drupal"},{name:"magento",label:"Magento",icon:"fab fa-magento"},{name:"Roundcube",label:"Roundcube webmail",icon:"fas fa-envelope"},{name:"shiftlib",label:"ShiftLib CMS",icon:"fas fa-user-edit"}],server_opts:[],selected:[],allSelected:!1,authRequired:!1,newWindow:!1,gitInfo:!1,showCloneApp:!1}),created(){this.fetchData()},watch:{$route:"fetchData"},methods:{fetchData(){var t=this;this.error="",this.fetching=!0,this.siteId=this.$route.params.id,o.Z.get("sites/"+this.siteId+"/apps").then((function(a){if(console.log(a),a.data.error)return t.error=a.data.error,!1;t.data=a.data.item,document.title="Apps | "+t.data.domain,t.data.stagingDomain="staging."+t.data.domain,o.Z.get("servers/").then((function(a){a.data.items.forEach((a=>{t.server_opts.push({text:a.name,value:a.id})}))}))})).catch((function(t){console.log(t)})).finally((function(){t.fetching=!1}))},install(t){"git"!==t?this.$confirm("Install "+t+"?").then((a=>{if(a){var e=this;this.error="",this.fetching=!0,this.loading=!0,o.Z.post("sites/"+this.$route.params.id+"/apps",{app:t}).then((function(t){console.log(t),t.data.error?e.error=t.data.error:e.fetchData()})).catch((function(t){console.log(t)})).finally((function(){e.fetching=!1,e.loading=!1}))}})):this.drawer=!0},clearLogs(){var t=this;this.fetching=!0,this.error="",o.Z.post("sites/"+this.siteId+"/apps",{flush:!0}).then((function(a){console.log(a),a.data.success?(t.drawer=!1,t.fetchData()):(t.error=a.data.error,t.fetching=!1)})).catch((function(a){console.log(a),t.fetching=!1})).finally((function(){}))},submitGit(){var t=this;this.data.git_url&&(this.fetching=!0,this.error="",o.Z.post("sites/"+this.siteId+"/apps",{git_url:this.data.git_url,public_dir:this.data.public_dir}).then((function(a){console.log(a),a.data.success?(t.drawer=!1,t.fetchData()):(t.error=a.data.error,t.fetching=!1)})).catch((function(a){console.log(a),t.fetching=!1})).finally((function(){})))},cloneApp(){this.error="";var t={server:this.data.server,domain:this.data.stagingDomain,origin:this.siteId,dns:this.dns};this.$refs.Site.create(t)},openSync(t){var a=this;this.target=t,this.syncDialog=!0,o.Z.get("sites/"+t+"/database/tables").then((function(t){console.log(t),a.tables=t.data.tables})).catch((function(t){console.log(t)})).finally((function(){}))},sync(){var t=this;this.error="",this.fetching=!0;var a={files:this.files,database:this.database,tables:this.tableNames},e=this.target===this.siteId?"pull":"push";o.Z.post("sites/"+this.siteId+"/apps/"+e,a).then((function(a){console.log(a),a.data.error&&(t.error=a.data.error)})).catch((function(t){console.log(t)})).finally((function(){t.fetching=!1,t.syncDialog=!1}))},pull(){var t=this;this.fetching=!0,o.Z.get("sites/"+this.siteId+"/apps/pull").then((function(t){console.log(t)})).catch((function(t){console.log(t)})).finally((function(){t.fetching=!1}))},selectAll:function(){if(this.tableNames=[],this.allSelected)for(var t in this.tables)this.tableNames.push(this.tables[t].toString())},select:function(){this.allSelected=!1},toggleStatus(){var t=this;this.error="",this.loading=!0,o.Z.post("sites/"+this.siteId+"/apps/",{status:this.data.app.online}).then((function(a){console.log(a),a.data.error?(t.error=a.data.error,t.fetching=!1):a.data.success&&t.fetchData()})).catch((function(a){console.log(a),t.fetching=!1})).finally((function(){t.loading=!1}))},gitPull(){var t=this;this.fetching=!0,o.Z.get("sites/"+this.siteId+"/git/pull").then((function(t){console.log(t)})).catch((function(t){console.log(t)})).finally((function(){t.fetching=!1}))},handleError(t){this.error=t}}},d=c,u=e(1001),p=(0,u.Z)(d,i,l,!1,null,null,null),v=p.exports}}]);
//# sourceMappingURL=2693.998f9697.js.map