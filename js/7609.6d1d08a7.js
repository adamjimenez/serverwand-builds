"use strict";(self["webpackChunkServerWand"]=self["webpackChunkServerWand"]||[]).push([[7609],{81815:function(e,t,a){a.d(t,{A:function(){return d}});var l=a(20641);function s(e,t,a,s,o,i){const n=(0,l.g2)("v-icon"),d=(0,l.g2)("v-alert"),r=(0,l.g2)("v-dialog");return(0,l.uX)(),(0,l.Wv)(r,{modelValue:e.show,"onUpdate:modelValue":t[0]||(t[0]=t=>e.show=t),persistent:"",width:"600"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{title:a.message,color:"primary"},{prepend:(0,l.k6)((()=>[(0,l.bF)(n,{icon:"fas fa-magic fa-2x faa-horizontal animated"})])),_:1},8,["title"])])),_:1},8,["modelValue"])}var o={name:"Loading",data:()=>({show:!1}),props:{value:{type:Boolean,default:!1},message:{type:String,default:"Summoning..."}},watch:{value:function(e){this.show=e}}},i=a(66262);const n=(0,i.A)(o,[["render",s]]);var d=n},77609:function(e,t,a){a.r(t),a.d(t,{default:function(){return U}});var l=a(20641),s=a(53751),o=a(90033);const i={key:0},n={key:0},d={key:1},r=["onClick"];function c(e,t,a,c,h,u){const p=(0,l.g2)("v-alert"),m=(0,l.g2)("Loading"),g=(0,l.g2)("EditFile"),f=(0,l.g2)("v-btn"),v=(0,l.g2)("Snapshot"),b=(0,l.g2)("Download"),k=(0,l.g2)("Restore"),y=(0,l.g2)("v-switch"),F=(0,l.g2)("v-row"),w=(0,l.g2)("v-icon"),C=(0,l.g2)("v-col"),_=(0,l.g2)("v-text-field"),V=(0,l.g2)("v-data-table"),I=(0,l.g2)("v-container"),A=(0,l.g2)("v-card"),D=(0,l.g2)("v-card-title"),S=(0,l.g2)("v-select"),E=(0,l.g2)("v-card-text"),W=(0,l.g2)("v-navigation-drawer"),x=(0,l.g2)("Confirm");return(0,l.uX)(),(0,l.CE)("div",null,[h.error?((0,l.uX)(),(0,l.Wv)(p,{key:0,type:"error",text:h.error},null,8,["text"])):(0,l.Q3)("",!0),h.message?((0,l.uX)(),(0,l.Wv)(p,{key:1,type:"info",text:h.message},null,8,["text"])):(0,l.Q3)("",!0),(0,l.bF)(m,{value:h.loading},null,8,["value"]),(0,l.bF)(g,{ref:"editFile",serverId:h.serverId,path:h.path,selected:u.selected,action:"backups",save:"false",onComplete:t[0]||(t[0]=e=>u.list()),onError:u.handleError},null,8,["serverId","path","selected","onError"]),(0,l.bF)(A,{loading:h.fetching},{default:(0,l.k6)((()=>[(0,l.bF)(I,{fluid:""},{default:(0,l.k6)((()=>[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(f,{onClick:u.configure,title:"Configure S3",icon:"mdi:mdi-settings"},null,8,["onClick"]),h.s3.access_key?((0,l.uX)(),(0,l.Wv)(v,{key:0,serverId:h.serverId,onComplete:u.handleComplete,onError:u.handleError},null,8,["serverId","onComplete","onError"])):(0,l.Q3)("",!0),(0,l.bF)(b,{serverId:h.serverId,path:h.path,selected:u.selected,onComplete:u.handleComplete,onError:u.handleError},null,8,["serverId","path","selected","onComplete","onError"]),(0,l.bF)(k,{serverId:h.serverId,path:h.path,selected:u.selected,onComplete:u.handleComplete,onError:u.handleError},null,8,["serverId","path","selected","onComplete","onError"]),(0,l.bF)(y,{modelValue:h.s3.active,"onUpdate:modelValue":t[1]||(t[1]=e=>h.s3.active=e),label:"Nightly backups",class:"my-0",onChange:t[2]||(t[2]=e=>u.toggleBackups()),"hide-details":"",color:"primary"},null,8,["modelValue"])])),_:1}),h.s3.access_key?((0,l.uX)(),(0,l.CE)("div",i,["/"!==h.path?((0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"flex-grow-0"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{icon:"",onClick:t[3]||(t[3]=e=>u.upLevel()),disabled:"/"===h.path},{default:(0,l.k6)((()=>[(0,l.bF)(w,{size:"small",icon:"mdi:mdi-arrow-up"})])),_:1},8,["disabled"])])),_:1}),(0,l.bF)(C,null,{default:(0,l.k6)((()=>[(0,l.bF)(_,{modelValue:h.path,"onUpdate:modelValue":t[4]||(t[4]=e=>h.path=e),class:"ma-0 pa-0",onChange:u.list,onKeydown:(0,s.jR)(u.list,["enter"]),"hide-details":""},null,8,["modelValue","onChange","onKeydown"])])),_:1})])),_:1}),(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(C,{cols:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(V,{headers:h.headers,items:h.items,"items-per-page":100,class:"results",ref:"results","mobile-breakpoint":"0",modelValue:h.selectedIds,"onUpdate:modelValue":t[5]||(t[5]=e=>h.selectedIds=e),"show-select":e.display.smAndUp,page:h.page,hover:"","row-props":u.rowProps,"fixed-header":"","hide-default-header":!e.display.smAndUp,style:{height:"calc(100vh - 370px)",overflow:"auto"},"onClick:row":t[6]||(t[6]=function(e,t){u.open(t.item)}),"onContextmenu:row":u.select,"onUpdate:page":u.updatePage},{"item.modified":(0,l.k6)((({item:e})=>[(0,l.eW)((0,o.v_)(u.formatDate(e.modified)),1)])),_:1},8,["headers","items","modelValue","show-select","page","row-props","hide-default-header","onContextmenu:row","onUpdate:page"])])),_:1})])),_:1})])):((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(C,{cols:"12"},{default:(0,l.k6)((()=>[(0,l.bF)(V,{headers:h.backupHeaders,items:h.backups,"items-per-page":100,"mobile-breakpoint":"0","onClick:row":t[8]||(t[8]=function(e,t){u.browse(t.item)}),hover:"","fixed-header":"",style:{height:"calc(100vh - 290px)",overflow:"auto"}},{"item.name":(0,l.k6)((({item:e})=>[(0,l.Lk)("span",{onClick:t=>u.browse(e)},(0,o.v_)(e.name),9,r)])),"item.timestamp":(0,l.k6)((({item:e})=>[(0,l.eW)((0,o.v_)(u.formatDate(e.timestamp)),1)])),"item.complete":(0,l.k6)((({item:e})=>[(0,l.eW)((0,o.v_)(e.complete?"Complete":"Incomplete"),1)])),"item.automatic":(0,l.k6)((({item:e})=>[(0,l.eW)((0,o.v_)(e.automatic?"Automatic":"Manual"),1)])),"item.duration":(0,l.k6)((({item:e})=>[(0,l.eW)((0,o.v_)(Math.round(e.duration/60))+"m ",1)])),"item.size":(0,l.k6)((({item:e})=>[(0,l.eW)((0,o.v_)(u.prettyBytes(e.size)),1)])),"item.actions":(0,l.k6)((({item:e})=>[(0,l.bF)(f,{icon:"",disabled:h.loading,loading:h.loading===e.name,onClick:[t=>u.deleteSnapshot(e.name),t[7]||(t[7]=(0,s.D$)((()=>{}),["stop"]))]},{default:(0,l.k6)((()=>[(0,l.bF)(w,{size:"small"},{default:(0,l.k6)((()=>t[14]||(t[14]=[(0,l.eW)("mdi:mdi-delete")]))),_:1})])),_:2},1032,["disabled","loading","onClick"])])),_:1},8,["headers","items"])])),_:1})])),_:1})]))])):(0,l.Q3)("",!0)])),_:1})])),_:1},8,["loading"]),(0,l.bF)(W,{app:"",modelValue:h.s3Drawer,"onUpdate:modelValue":t[13]||(t[13]=e=>h.s3Drawer=e),temporary:"",location:"right"},{default:(0,l.k6)((()=>[(0,l.bF)(A,null,{default:(0,l.k6)((()=>[(0,l.bF)(D,null,{default:(0,l.k6)((()=>t[15]||(t[15]=[(0,l.eW)(" S3 Settings ")]))),_:1}),(0,l.bF)(E,null,{default:(0,l.k6)((()=>[(0,l.bF)(S,{modelValue:h.s3.host,"onUpdate:modelValue":t[9]||(t[9]=e=>h.s3.host=e),items:h.hosts,label:"Host"},null,8,["modelValue","items"]),(0,l.bF)(_,{modelValue:h.s3.access_key,"onUpdate:modelValue":t[10]||(t[10]=e=>h.s3.access_key=e),label:"Access Key",required:""},null,8,["modelValue"]),(0,l.bF)(_,{modelValue:h.s3.secret_key,"onUpdate:modelValue":t[11]||(t[11]=e=>h.s3.secret_key=e),label:"Secret Key",required:""},null,8,["modelValue"]),(0,l.bF)(_,{modelValue:h.s3.bucket,"onUpdate:modelValue":t[12]||(t[12]=e=>h.s3.bucket=e),label:"Bucket",required:""},null,8,["modelValue"]),(0,l.bF)(f,{disabled:h.fetching,loading:h.loading,color:"success",onClick:u.save},{default:(0,l.k6)((()=>t[16]||(t[16]=[(0,l.eW)(" Save ")]))),_:1},8,["disabled","loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(x,{ref:"confirm"},null,512)])}a(44114),a(98992),a(72577),a(3949);var h=a(74300),u=a(81815);const p={key:0};function m(e,t,a,s,o,i){const n=(0,l.g2)("v-icon"),d=(0,l.g2)("v-btn");return 1===a.selected?.length&&"file"===a.selected[0].type?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.bF)(d,{onClick:t[0]||(t[0]=e=>i.download()),title:"Download",icon:"",loading:o.fetching},{default:(0,l.k6)((()=>[(0,l.bF)(n,null,{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.eW)("mdi:mdi-download")]))),_:1})])),_:1},8,["loading"])])):(0,l.Q3)("",!0)}var g=a(27274),f={props:{serverId:null,path:null,selected:null},watch:{path:function(e){this.data.path=e},selected:function(e){this.data.selected=e}},data(){return{fetching:!1,data:{},error:"",dialog:!1}},methods:{download:async function(){this.$emit("loading",!0);let e=this.selected[0];return console.log(e),console.log(this.selected),h.A.post("servers/"+this.serverId+"/backups",{cmd:"get",id:e.id}).then((t=>{g.A.download(t.data.content,e.id)})).catch((e=>console.log(e))).finally((()=>{this.fetching=!1,this.$emit("loading",!1)}))}}},v=a(66262);const b=(0,v.A)(f,[["render",m]]);var k=b;const y={key:0};function F(e,t,a,s,o,i){const n=(0,l.g2)("v-icon"),d=(0,l.g2)("v-btn"),r=(0,l.g2)("Confirm");return a.selected.length?((0,l.uX)(),(0,l.CE)("div",y,[(0,l.bF)(d,{onClick:t[0]||(t[0]=e=>i.restore()),title:"Restore",icon:"",loading:o.fetching},{default:(0,l.k6)((()=>[(0,l.bF)(n,null,{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.eW)("mdi:mdi-restore")]))),_:1})])),_:1},8,["loading"]),(0,l.bF)(r,{ref:"confirm"},null,512)])):(0,l.Q3)("",!0)}var w=a(26301),C={components:{Confirm:w.A},props:{serverId:null,path:null,selected:null},watch:{path:function(e){this.data.path=e},selected:function(e){this.data.selected=e}},data(){return{fetching:!1,data:{},error:"",dialog:!1}},methods:{restore:async function(){if(!await this.$refs.confirm.open("Restore selected files?"))return;this.fetching=!0;let e=[];this.selected.forEach((t=>{e.push(t.name)})),h.A.post("servers/"+this.serverId+"/backups",{cmd:"restore",path:this.path,files:e}).then((e=>{if(console.log(e),e.data.success)this.$emit("complete",e.data.result);else{let t=e.data.error?e.data.error:e.data;this.$emit("error",t)}})).catch((e=>console.log(e))).finally((()=>this.fetching=!1))}}};const _=(0,v.A)(C,[["render",F]]);var V=_;function I(e,t,a,s,o,i){const n=(0,l.g2)("v-icon"),d=(0,l.g2)("v-btn"),r=(0,l.g2)("v-card-title"),c=(0,l.g2)("v-text-field"),h=(0,l.g2)("v-card-text"),u=(0,l.g2)("v-card"),p=(0,l.g2)("v-dialog"),m=(0,l.g2)("v-textarea"),g=(0,l.g2)("v-divider"),f=(0,l.g2)("v-spacer"),v=(0,l.g2)("v-card-actions");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(d,{onClick:i.newSnapshot,title:"Create snapshot",icon:""},{default:(0,l.k6)((()=>[(0,l.bF)(n,null,{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)("mdi:mdi-cloud-upload")]))),_:1})])),_:1},8,["onClick"]),(0,l.bF)(p,{app:"",modelValue:o.dialog,"onUpdate:modelValue":t[1]||(t[1]=e=>o.dialog=e)},{default:(0,l.k6)((()=>[(0,l.bF)(u,{loading:o.fetching},{default:(0,l.k6)((()=>[(0,l.bF)(r,null,{default:(0,l.k6)((()=>t[5]||(t[5]=[(0,l.eW)(" Snapshot ")]))),_:1}),(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:o.name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.name=e),label:"Name",autofocus:""},null,8,["modelValue"]),(0,l.bF)(d,{color:"primary",onClick:i.createSnapshot,disabled:0===o.name.length},{default:(0,l.k6)((()=>t[6]||(t[6]=[(0,l.eW)(" Create snapshot ")]))),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"]),(0,l.bF)(p,{app:"",scrollable:"",persistent:"",modelValue:o.showMessage,"onUpdate:modelValue":t[3]||(t[3]=e=>o.showMessage=e)},{default:(0,l.k6)((()=>[(0,l.bF)(u,{loading:o.fetching},{default:(0,l.k6)((()=>[(0,l.bF)(r,null,{default:(0,l.k6)((()=>t[7]||(t[7]=[(0,l.eW)(" Response ")]))),_:1}),(0,l.bF)(h,{id:"messageBody"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{value:o.message,readonly:"","auto-grow":"",loading:o.fetching},null,8,["value","loading"])])),_:1}),(0,l.bF)(g),(0,l.bF)(v,null,{default:(0,l.k6)((()=>[(0,l.bF)(f),(0,l.bF)(d,{onClick:t[2]||(t[2]=t=>{e.$emit("closed"),o.showMessage=!1}),disabled:o.fetching},{default:(0,l.k6)((()=>t[8]||(t[8]=[(0,l.eW)(" Close ")]))),_:1},8,["disabled"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])}var A={props:{serverId:null},data(){return{message:"",fetching:!1,name:"",dialog:!1,showMessage:!1}},methods:{newSnapshot(){this.dialog=!0},createSnapshot(){this.fetching=!0,h.A.post("servers/"+this.serverId+"/backups",{cmd:"snapshot",name:this.name}).then((e=>{if(console.log(e),this.dialog=!1,e.data.success)this.$emit("complete",e.data.result);else{let t=e.data.error?e.data.error:e.data;this.$emit("error",t)}})).catch((e=>console.log(e))).finally((()=>this.fetching=!1))}}};const D=(0,v.A)(A,[["render",I]]);var S=D,E=a(31322),W={components:{Loading:u.A,Download:k,Restore:V,Snapshot:S,EditFile:E.A,Confirm:w.A},data(){return{path:"/",error:"",message:"",backups:[],items:[],data:{},details:"",loading:null,fetching:!1,serverId:0,s3Drawer:!1,s3:{access_key:"",active:!1},selectedIds:[],hosts:[{title:"AWS",value:""},{title:"Linode (Atlanta, GA)",value:"https://us-southeast-1.linodeobjects.com"},{title:"Linode (Frankfurt, DE)",value:"https://eu-central-1.linodeobjects.com"},{title:"Linode (Newark, NJ)",value:"https://us-east-1.linodeobjects.com"},{title:"Linode (Singapore, SG)",value:"https://ap-south-1.linodeobjects.com"},{title:"Digital Ocean (NYC3)",value:"https://nyc3.digitaloceanspaces.com"},{title:"Digital Ocean (SFO3)",value:"https://sfo3.digitaloceanspaces.com"},{title:"Digital Ocean (AMS3)",value:"https://ams3.digitaloceanspaces.com"},{title:"Digital Ocean (SGP1)",value:"https://sgp1.digitaloceanspaces.com"},{title:"Digital Ocean (FRA1)",value:"https://fra1.digitaloceanspaces.com"},{title:"Vultr",value:"https://ewr1.vultrobjects.com"}],headers:[{title:"Name ",key:"name"},{title:"Size ",key:"size"},{title:"Last modified ",key:"modified"}],backupHeaders:[{title:"Name",key:"name"},{title:"Date",key:"date"},{title:"Status",key:"complete",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:"Type",key:"automatic",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:"Duration",key:"duration",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:"Size",key:"size",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:" ",key:"action"}],page:1}},computed:{dir:function(){let e=this.path;if(!e.endsWith("/")){let t=e.lastIndexOf("/");-1!==t&&(e=e.substr(0,t))}return e},selected:function(){let e=[];return this.selectedIds.forEach((t=>{let a=this.items.find((e=>e.id===t));a&&e.push(a)})),e}},created(){this.display=this.$vuetify.display,this.serverId=this.$route.params.id,this.fetchData()},methods:{fetchData(){this.error="",this.message="",this.fetching=!0,h.A.post("servers/"+this.serverId+"/backups",{path:this.path}).then((e=>{console.log(e),e.data.error?this.error=e.data.error:(this.s3=e.data.s3,this.server=e.data.item,e.data.backups&&e.data.backups.length&&(this.backups=e.data.backups),document.title="Backups | "+this.server.name,this.list())})).catch((e=>{console.log(e)})).finally((()=>{this.fetching=!1}))},browse(e){console.log(e),this.path="/"+e.name+"/",this.list()},list(){this.error="",this.message="",this.fetching=!0,h.A.post("servers/"+this.serverId+"/backups?cmd=list",{path:this.path}).then((e=>{console.log(e),e.data.error?this.error=e.data.error:(this.page=1,this.items=[],e.data.files.forEach((e=>{this.items.push({id:e.id,name:e.name,size:e.size?e.size:0,type:e.type,modified:e.modified,perms:e.perms,permsn:e.permsn,owner:e.owner,group:e.group,selected:!1})})))})).catch((e=>{console.log(e)})).finally((()=>{this.fetching=!1}))},open(e){"folder"===e.type||"link"===e.type?(this.path=e.id,this.list()):"file"===e.type&&this.$refs.editFile.open(e)},upLevel(){let e=this.path.substr(0,this.path.length-1).lastIndexOf("/");-1!==e&&(this.path=this.path.substr(0,e+1),this.path||(this.path="/")),this.list()},configure(){this.s3Drawer=!0},save(){this.fetching=!0,h.A.post("servers/"+this.serverId+"/backups",this.s3).then((()=>{this.fetchData(),this.s3Drawer=!1})).catch((e=>{console.log(e),this.fetching=!1}))},async deleteSnapshot(e){if(await this.$refs.confirm.open("Delete "+e+"?"))return this.loading=e,this.error="",h.A.post("servers/"+this.serverId+"/backups",{cmd:"deleteSnapshot",name:e}).then((e=>{console.log(e),e.data.success?this.fetchData():(this.error=e.data.error,this.fetching=!1)})).catch((e=>{console.log(e)})).finally((()=>{this.loading=null})),!1},handleError(e){this.error=e},handleComplete(e){console.log(e),this.message=e},toggleBackups(){this.fetching=!0,this.error="",h.A.post("servers/"+this.serverId+"/backups",{active:this.s3.active}).then((e=>{console.log(e),e.data.success?this.fetchData():this.error=e.data.error})).catch((e=>{console.log(e)})).finally((()=>{this.fetching=!1}))},formatDate(e){return g.A.formatDate(e)},prettyBytes(e){return g.A.prettyBytes(e)},updatePage(e){this.page=e},rowProps(e){if(this.selected.find((t=>t.id===e.item.id)))return{class:"bg-primary"}},select(e,t){e.preventDefault();let a=-1;this.selectedIds.forEach(((e,l)=>{t.item.id==e&&(a=l)})),a>-1?this.selectedIds.splice(a,1):this.selectedIds.push(t.item.id)}}};const x=(0,v.A)(W,[["render",c]]);var U=x}}]);
//# sourceMappingURL=7609.6d1d08a7.js.map