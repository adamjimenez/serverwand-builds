"use strict";(self["webpackChunkServerWand"]=self["webpackChunkServerWand"]||[]).push([[5177],{64574:function(e,t,a){a.d(t,{Z:function(){return c}});var l=a(66252),s=a(3577),o=a(49963);function i(e,t,a,i,n,r){const d=(0,l.up)("v-toolbar-title"),c=(0,l.up)("v-toolbar"),u=(0,l.up)("v-card-text"),m=(0,l.up)("v-spacer"),p=(0,l.up)("v-btn"),h=(0,l.up)("v-card-actions"),f=(0,l.up)("v-card"),g=(0,l.up)("v-dialog");return(0,l.wg)(),(0,l.j4)(g,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialog=t),"max-width":e.options.width,style:(0,s.j5)({zIndex:e.options.zIndex}),onKeydown:(0,o.D2)(r.cancel,["esc"]),persistent:""},{default:(0,l.w5)((()=>[(0,l.Wm)(f,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{dark:"",color:e.options.color,dense:"",flat:""},{default:(0,l.w5)((()=>[(0,l.Wm)(d,{class:"text-body-2 font-weight-bold grey--text"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,s.zw)(e.title),1)])),_:1})])),_:1},8,["color"]),(0,l.wy)((0,l.Wm)(u,{class:"pa-4 black--text",innerHTML:e.message},null,8,["innerHTML"]),[[o.F8,!!e.message]]),(0,l.Wm)(h,{class:"pt-3"},{default:(0,l.w5)((()=>[(0,l.Wm)(m),e.options.noconfirm?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(p,{key:0,color:"grey",text:"",class:"body-2 font-weight-bold",onClick:r.cancel},{default:(0,l.w5)((()=>[(0,l.Uk)("Cancel")])),_:1},8,["onClick"])),(0,l.Wm)(p,{color:"primary",class:"body-2 font-weight-bold",outlined:"",onClick:r.agree},{default:(0,l.w5)((()=>[(0,l.Uk)("OK")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue","max-width","style","onKeydown"])}var n={data:function(){return{dialog:!1,resolve:null,reject:null,message:null,title:null,options:{color:"grey lighten-3",width:400,zIndex:10008,noconfirm:!1}}},methods:{open(e,t,a){return t||(t=e,e="Confirm"),this.dialog=!0,this.title=e,this.message=t,this.options=Object.assign(this.options,a),new Promise(((e,t)=>{this.resolve=e,this.reject=t}))},agree(){this.resolve(!0),this.dialog=!1},cancel(){this.resolve(!1),this.dialog=!1}}},r=a(83744);const d=(0,r.Z)(n,[["render",i]]);var c=d},11297:function(e,t,a){a.d(t,{Z:function(){return r}});var l=a(66252);function s(e,t,a,s,o,i){const n=(0,l.up)("v-icon"),r=(0,l.up)("v-alert"),d=(0,l.up)("v-dialog");return(0,l.wg)(),(0,l.j4)(d,{modelValue:e.show,"onUpdate:modelValue":t[0]||(t[0]=t=>e.show=t),persistent:"",width:"600"},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{title:a.message,color:"primary"},{prepend:(0,l.w5)((()=>[(0,l.Wm)(n,{icon:"fas fa-magic fa-2x faa-horizontal animated"})])),_:1},8,["title"])])),_:1},8,["modelValue"])}var o={name:"Loading",data:()=>({show:!1}),props:{value:{type:Boolean,default:!1},message:{type:String,default:"Summoning..."}},watch:{value:function(e){this.show=e}}},i=a(83744);const n=(0,i.Z)(o,[["render",s]]);var r=n},95177:function(e,t,a){a.r(t),a.d(t,{default:function(){return I}});var l=a(66252),s=a(49963),o=a(3577);const i={key:0},n={key:0},r={key:1},d=["onClick"];function c(e,t,a,c,u,m){const p=(0,l.up)("v-alert"),h=(0,l.up)("Loading"),f=(0,l.up)("EditFile"),g=(0,l.up)("v-btn"),v=(0,l.up)("Snapshot"),w=(0,l.up)("Restore"),k=(0,l.up)("v-switch"),b=(0,l.up)("v-row"),y=(0,l.up)("v-icon"),W=(0,l.up)("v-col"),_=(0,l.up)("v-text-field"),C=(0,l.up)("v-data-table"),V=(0,l.up)("v-container"),D=(0,l.up)("v-card"),U=(0,l.up)("v-card-title"),I=(0,l.up)("v-select"),S=(0,l.up)("v-card-text"),x=(0,l.up)("v-navigation-drawer"),z=(0,l.up)("Confirm");return(0,l.wg)(),(0,l.iD)("div",null,[u.error?((0,l.wg)(),(0,l.j4)(p,{key:0,type:"error",text:u.error},null,8,["text"])):(0,l.kq)("",!0),u.message?((0,l.wg)(),(0,l.j4)(p,{key:1,type:"info",text:u.message},null,8,["text"])):(0,l.kq)("",!0),(0,l.Wm)(h,{value:u.loading},null,8,["value"]),(0,l.Wm)(f,{ref:"editFile",serverId:u.serverId,path:u.path,selected:m.selected,action:"backups",save:"false",onComplete:t[0]||(t[0]=e=>m.list()),onError:m.handleError},null,8,["serverId","path","selected","onError"]),(0,l.Wm)(D,{loading:u.fetching},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{fluid:""},{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,{onClick:m.configure,title:"Configure S3",icon:"mdi:mdi-settings"},null,8,["onClick"]),u.s3.access_key?((0,l.wg)(),(0,l.j4)(v,{key:0,serverId:u.serverId,onComplete:m.handleComplete,onError:m.handleError},null,8,["serverId","onComplete","onError"])):(0,l.kq)("",!0),(0,l.Wm)(w,{serverId:u.serverId,path:u.path,selected:m.selected,onComplete:m.handleComplete,onError:m.handleError},null,8,["serverId","path","selected","onComplete","onError"]),(0,l.Wm)(k,{modelValue:u.s3.active,"onUpdate:modelValue":t[1]||(t[1]=e=>u.s3.active=e),label:"Nightly backups",class:"my-0",onChange:t[2]||(t[2]=e=>m.toggleBackups()),"hide-details":"",color:"primary"},null,8,["modelValue"])])),_:1}),u.s3.access_key?((0,l.wg)(),(0,l.iD)("div",i,["/"!==u.path?((0,l.wg)(),(0,l.iD)("div",n,[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{class:"flex-grow-0"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{icon:"",onClick:t[3]||(t[3]=e=>m.upLevel()),disabled:"/"===u.path},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{size:"small",icon:"mdi:mdi-arrow-up"})])),_:1},8,["disabled"])])),_:1}),(0,l.Wm)(W,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,{modelValue:u.path,"onUpdate:modelValue":t[4]||(t[4]=e=>u.path=e),class:"ma-0 pa-0",onChange:m.list,onKeydown:(0,s.D2)(m.list,["enter"]),"hide-details":""},null,8,["modelValue","onChange","onKeydown"])])),_:1})])),_:1}),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{cols:"12"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{headers:u.headers,items:u.items,class:"results",ref:"results","mobile-breakpoint":"0","onClick:row":t[5]||(t[5]=function(e,t){m.open(t.item)}),modelValue:u.selectedIds,"onUpdate:modelValue":t[6]||(t[6]=e=>u.selectedIds=e),"show-select":""},{"item.modified":(0,l.w5)((({item:e})=>[(0,l.Uk)((0,o.zw)(m.formatDate(e.modified)),1)])),_:1},8,["headers","items","modelValue"])])),_:1})])),_:1})])):((0,l.wg)(),(0,l.iD)("div",r,[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{cols:"12"},{default:(0,l.w5)((()=>[(0,l.Wm)(C,{headers:u.backupHeaders,items:u.backups,"mobile-breakpoint":"0","onClick:row":t[8]||(t[8]=function(e,t){m.browse(t.item)})},{"item.name":(0,l.w5)((({item:e})=>[(0,l._)("span",{onClick:t=>m.browse(e)},(0,o.zw)(e.name),9,d)])),"item.timestamp":(0,l.w5)((({item:e})=>[(0,l.Uk)((0,o.zw)(m.formatDate(e.timestamp)),1)])),"item.complete":(0,l.w5)((({item:e})=>[(0,l.Uk)((0,o.zw)(e.complete?"Complete":"Incomplete"),1)])),"item.automatic":(0,l.w5)((({item:e})=>[(0,l.Uk)((0,o.zw)(e.automatic?"Automatic":"Manual"),1)])),"item.duration":(0,l.w5)((({item:e})=>[(0,l.Uk)((0,o.zw)(Math.round(e.duration/60))+"m ",1)])),"item.size":(0,l.w5)((({item:e})=>[(0,l.Uk)((0,o.zw)(m.prettyBytes(e.size)),1)])),"item.actions":(0,l.w5)((({item:e})=>[(0,l.Wm)(g,{icon:"",disabled:u.loading,loading:u.loading===e.name,onClick:[t=>m.deleteSnapshot(e.name),t[7]||(t[7]=(0,s.iM)((()=>{}),["stop"]))]},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{size:"small"},{default:(0,l.w5)((()=>[(0,l.Uk)("mdi:mdi-delete")])),_:1})])),_:2},1032,["disabled","loading","onClick"])])),_:1},8,["headers","items"])])),_:1})])),_:1})]))])):(0,l.kq)("",!0)])),_:1})])),_:1},8,["loading"]),(0,l.Wm)(x,{app:"",modelValue:u.s3Drawer,"onUpdate:modelValue":t[13]||(t[13]=e=>u.s3Drawer=e),temporary:"",location:"right"},{default:(0,l.w5)((()=>[(0,l.Wm)(D,null,{default:(0,l.w5)((()=>[(0,l.Wm)(U,null,{default:(0,l.w5)((()=>[(0,l.Uk)(" S3 Settings ")])),_:1}),(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l.Wm)(I,{modelValue:u.s3.host,"onUpdate:modelValue":t[9]||(t[9]=e=>u.s3.host=e),items:u.hosts,label:"Host"},null,8,["modelValue","items"]),(0,l.Wm)(_,{modelValue:u.s3.access_key,"onUpdate:modelValue":t[10]||(t[10]=e=>u.s3.access_key=e),label:"Access Key",required:""},null,8,["modelValue"]),(0,l.Wm)(_,{modelValue:u.s3.secret_key,"onUpdate:modelValue":t[11]||(t[11]=e=>u.s3.secret_key=e),label:"Secret Key",required:""},null,8,["modelValue"]),(0,l.Wm)(_,{modelValue:u.s3.bucket,"onUpdate:modelValue":t[12]||(t[12]=e=>u.s3.bucket=e),label:"Bucket",required:""},null,8,["modelValue"]),(0,l.Wm)(g,{disabled:u.fetching,loading:u.loading,color:"success",onClick:m.save},{default:(0,l.w5)((()=>[(0,l.Uk)(" Save ")])),_:1},8,["disabled","loading","onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(z,{ref:"confirm"},null,512)])}a(70560);var u=a(1006),m=a(11297);const p={key:0};function h(e,t,a,s,o,i){const n=(0,l.up)("v-icon"),r=(0,l.up)("v-btn"),d=(0,l.up)("Confirm");return a.selected.length?((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(r,{onClick:t[0]||(t[0]=e=>i.restore()),title:"Restore",icon:"",loading:o.fetching},{default:(0,l.w5)((()=>[(0,l.Wm)(n,null,{default:(0,l.w5)((()=>[(0,l.Uk)("mdi:mdi-restore")])),_:1})])),_:1},8,["loading"]),(0,l.Wm)(d,{ref:"confirm"},null,512)])):(0,l.kq)("",!0)}var f=a(64574),g={components:{Confirm:f.Z},props:{serverId:null,path:null,selected:null},watch:{path:function(e){this.data.path=e},selected:function(e){this.data.selected=e}},data(){return{fetching:!1,data:{},error:"",dialog:!1}},methods:{restore:async function(){if(await this.$refs.confirm.open("Restore selected files?")){var e=this;this.fetching=!0;var t=[];this.selected.forEach((e=>{t.push(e.name)})),u.Z.post("servers/"+this.serverId+"/backups",{cmd:"restore",path:this.path,files:t}).then((t=>{if(console.log(t),t.data.success)e.$emit("complete",t.data.result);else{var a=t.data.error?t.data.error:t.data;e.$emit("error",a)}})).catch((e=>console.log(e))).finally((()=>e.fetching=!1))}}}},v=a(83744);const w=(0,v.Z)(g,[["render",h]]);var k=w;function b(e,t,a,s,o,i){const n=(0,l.up)("v-icon"),r=(0,l.up)("v-btn"),d=(0,l.up)("v-card-title"),c=(0,l.up)("v-text-field"),u=(0,l.up)("v-card-text"),m=(0,l.up)("v-card"),p=(0,l.up)("v-dialog"),h=(0,l.up)("v-textarea"),f=(0,l.up)("v-divider"),g=(0,l.up)("v-spacer"),v=(0,l.up)("v-card-actions");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(r,{onClick:i.newSnapshot,title:"Create snapshot",icon:""},{default:(0,l.w5)((()=>[(0,l.Wm)(n,null,{default:(0,l.w5)((()=>[(0,l.Uk)("mdi:mdi-cloud-upload")])),_:1})])),_:1},8,["onClick"]),(0,l.Wm)(p,{app:"",modelValue:o.dialog,"onUpdate:modelValue":t[1]||(t[1]=e=>o.dialog=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{loading:o.fetching},{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)(" Snapshot ")])),_:1}),(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c,{modelValue:o.name,"onUpdate:modelValue":t[0]||(t[0]=e=>o.name=e),label:"Name",autofocus:""},null,8,["modelValue"]),(0,l.Wm)(r,{color:"primary",onClick:i.createSnapshot,disabled:0===o.name.length},{default:(0,l.w5)((()=>[(0,l.Uk)(" Create snapshot ")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"]),(0,l.Wm)(p,{app:"",scrollable:"",persistent:"",modelValue:o.showMessage,"onUpdate:modelValue":t[3]||(t[3]=e=>o.showMessage=e)},{default:(0,l.w5)((()=>[(0,l.Wm)(m,{loading:o.fetching},{default:(0,l.w5)((()=>[(0,l.Wm)(d,null,{default:(0,l.w5)((()=>[(0,l.Uk)(" Response ")])),_:1}),(0,l.Wm)(u,{id:"messageBody"},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{value:o.message,readonly:"","auto-grow":"",loading:o.fetching},null,8,["value","loading"])])),_:1}),(0,l.Wm)(f),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g),(0,l.Wm)(r,{onClick:t[2]||(t[2]=t=>{e.$emit("closed"),o.showMessage=!1}),disabled:o.fetching},{default:(0,l.w5)((()=>[(0,l.Uk)(" Close ")])),_:1},8,["disabled"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])}var y={props:{serverId:null},data(){return{message:"",fetching:!1,name:"",dialog:!1,showMessage:!1}},methods:{newSnapshot(){this.dialog=!0},createSnapshot(){var e=this;this.fetching=!0,u.Z.post("servers/"+this.serverId+"/backups",{cmd:"snapshot",name:this.name}).then((t=>{if(console.log(t),e.dialog=!1,t.data.success)e.$emit("complete",t.data.result);else{var a=t.data.error?t.data.error:t.data;e.$emit("error",a)}})).catch((e=>console.log(e))).finally((()=>e.fetching=!1))}}};const W=(0,v.Z)(y,[["render",b]]);var _=W,C=a(33348),V=a(72564),D={components:{Loading:m.Z,Restore:k,Snapshot:_,EditFile:C.Z,Confirm:f.Z},data(){return{path:"/",error:"",message:"",backups:[],items:[],data:{},details:"",loading:null,fetching:!1,serverId:0,s3Drawer:!1,s3:{access_key:"",active:!1},selectedIds:[],hosts:[{title:"AWS",value:""},{title:"Linode (Atlanta, GA)",value:"https://us-southeast-1.linodeobjects.com"},{title:"Linode (Frankfurt, DE)",value:"https://eu-central-1.linodeobjects.com"},{title:"Linode (Newark, NJ)",value:"https://us-east-1.linodeobjects.com"},{title:"Linode (Singapore, SG)",value:"https://ap-south-1.linodeobjects.com"},{title:"Digital Ocean (NYC3)",value:"https://nyc3.digitaloceanspaces.com"},{title:"Digital Ocean (SFO3)",value:"https://sfo3.digitaloceanspaces.com"},{title:"Digital Ocean (AMS3)",value:"https://ams3.digitaloceanspaces.com"},{title:"Digital Ocean (SGP1)",value:"https://sgp1.digitaloceanspaces.com"},{title:"Digital Ocean (FRA1)",value:"https://fra1.digitaloceanspaces.com"},{title:"Vultr",value:"https://ewr1.vultrobjects.com"}],headers:[{title:"Name ",key:"name"},{title:"Size ",key:"size"},{title:"Last modified ",key:"modified"}],backupHeaders:[{title:"Name",key:"name"},{title:"Date",key:"date"},{title:"Status",key:"complete",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:"Type",key:"automatic",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:"Duration",key:"duration",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:"Size",key:"size",class:"d-none d-sm-table-cell",cellClass:"d-none d-sm-table-cell"},{title:" ",key:"action"}]}},computed:{dir:function(){let e=this.path;if(!e.endsWith("/")){let t=e.lastIndexOf("/");-1!==t&&(e=e.substr(0,t))}return e},selected:function(){let e=[];var t=this;return this.selectedIds.forEach((function(a){var l=t.items.find((e=>e.id===a));l&&e.push(l)})),e}},created(){this.serverId=this.$route.params.id,this.fetchData()},methods:{fetchData(){var e=this;this.error="",this.message="",this.fetching=!0,u.Z.post("servers/"+this.serverId+"/backups",{path:this.path}).then((function(t){console.log(t),t.data.error?e.error=t.data.error:(e.s3=t.data.s3,e.server=t.data.item,t.data.backups&&t.data.backups.length&&(e.backups=t.data.backups),document.title="Backups | "+e.server.name,e.list())})).catch((function(e){console.log(e)})).finally((function(){e.fetching=!1}))},browse(e){console.log(e),this.path="/"+e.name,this.list()},list(){var e=this;this.error="",this.message="",this.fetching=!0,u.Z.post("servers/"+this.serverId+"/backups?cmd=list",{path:this.path}).then((function(t){console.log(t),t.data.error?e.error=t.data.error:(e.items=[],t.data.files.forEach((t=>{e.items.push({id:t.id,name:t.name,size:t.size?t.size:0,type:t.type,modified:t.modified,perms:t.perms,permsn:t.permsn,owner:t.owner,group:t.group,selected:!1})})))})).catch((function(e){console.log(e)})).finally((function(){e.fetching=!1}))},open(e){"folder"===e.type||"link"===e.type?(this.path=e.id,this.list()):"file"===e.type&&this.$refs.editFile.open(e)},upLevel(){console.log(this.path);var e=this.path.lastIndexOf("/");-1!==e&&(this.path=this.path.substr(0,e),this.path||(this.path="/")),this.list()},configure(){this.s3Drawer=!0},save(){var e=this;this.fetching=!0,u.Z.post("servers/"+this.serverId+"/backups",this.s3).then((function(){e.fetchData(),e.s3Drawer=!1})).catch((function(t){console.log(t),e.fetching=!1}))},async deleteSnapshot(e){if(await this.$refs.confirm.open("Delete "+e+"?")){var t=this;return this.loading=e,this.error="",u.Z.post("servers/"+this.serverId+"/backups",{cmd:"deleteSnapshot",name:e}).then((function(e){console.log(e),e.data.success?t.fetchData():(t.error=e.data.error,t.fetching=!1)})).catch((function(e){console.log(e)})).finally((function(){t.loading=null})),!1}},handleError(e){this.error=e},handleComplete(e){console.log(e),this.message=e},toggleBackups(){var e=this;this.fetching=!0,this.error="",u.Z.post("servers/"+this.serverId+"/backups",{active:this.s3.active}).then((function(t){console.log(t),t.data.success?e.fetchData():e.error=t.data.error})).catch((function(e){console.log(e)})).finally((function(){e.fetching=!1}))},formatDate(e){return V.Z.formatDate(e)},prettyBytes(e){return V.Z.prettyBytes(e)}}};const U=(0,v.Z)(D,[["render",c]]);var I=U}}]);
//# sourceMappingURL=5177.bf8a5478.js.map