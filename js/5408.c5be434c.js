"use strict";(self["webpackChunkServerWand"]=self["webpackChunkServerWand"]||[]).push([[5408],{75408:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var a=r(66252),l=r(3577);const n=["innerHTML"],o=["innerHTML"];function s(e,t,r,s,i,c){const u=(0,a.up)("v-alert"),d=(0,a.up)("EditFile"),h=(0,a.up)("v-select"),f=(0,a.up)("v-text-field"),g=(0,a.up)("v-icon"),p=(0,a.up)("v-btn"),v=(0,a.up)("v-row"),m=(0,a.up)("v-card-title"),w=(0,a.up)("v-card-text"),L=(0,a.up)("v-card");return(0,a.wg)(),(0,a.iD)("div",null,[i.error?((0,a.wg)(),(0,a.j4)(u,{key:0,type:"error",text:i.error},null,8,["text"])):(0,a.kq)("",!0),(0,a.Wm)(d,{ref:"editFile",serverId:i.serverId,action:"files",onComplete:t[0]||(t[0]=e=>c.fetchLog()),onError:c.handleError,onLoading:c.handleLoading},null,8,["serverId","onError","onLoading"]),(0,a.Wm)(L,{loading:i.fetching},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{"primary-title":""},{default:(0,a.w5)((()=>[(0,a.Wm)(v,null,{default:(0,a.w5)((()=>[(0,a.Wm)(h,{items:i.logs,label:"Log","onUpdate:modelValue":c.fetchLog,"hide-details":"",class:"ma-1"},null,8,["items","onUpdate:modelValue"]),(0,a.Wm)(f,{label:"Filter",modelValue:i.filter,"onUpdate:modelValue":t[1]||(t[1]=e=>i.filter=e),"hide-details":"",class:"ma-1"},null,8,["modelValue"]),(0,a.Wm)(p,{onClick:t[2]||(t[2]=e=>c.fetchLog()),disabled:!i.log,icon:"",class:"ma-3"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:(0,l.C_)(i.fetching?"fa-spin":""),size:"small"},{default:(0,a.w5)((()=>[(0,a.Uk)("fas fa-redo-alt")])),_:1},8,["class"])])),_:1},8,["disabled"])])),_:1})])),_:1}),(0,a.Wm)(w,null,{default:(0,a.w5)((()=>["serverstatus"==i.log?((0,a.wg)(),(0,a.iD)("div",{key:0,innerHTML:i.logContent,class:"serverstatus"},null,8,n)):((0,a.wg)(),(0,a.iD)("div",{key:1,class:"pre",innerHTML:c.filteredLog},null,8,o))])),_:1})])),_:1},8,["loading"])])}var i=r(1006),c=r(24845),u={components:{EditFile:c.Z},data(){return{error:"",data:{users:{}},system_user:{user:"",password:""},cronjob:{name:"",user:"",command:"",minute:"",hour:"",dom:"",mon:"",dow:""},cronjobs:[],rules:{required:e=>!!e||"Required.",alpha:e=>/^[a-zA-Z]+$/g.test(e)||"Must contain a-z characters only",minute:e=>"*"==e||e>=0&&e<60||"0-59 or *",hour:e=>"*"==e||e>=0&&e<24||"0-23 or *",dom:e=>"*"==e||e>=1&&e<=31||"1-31 or *",mon:e=>"*"==e||e>=1&&e<12||"1-12 or *",dow:e=>"*"==e||e>=1&&e<7||"1-7 or *"},details:"",fetching:!0,userDrawer:!1,cronjobDrawer:!1,serverId:0,logs:[{value:"journal",title:"Journal"},{value:"auth",title:"Auth"},{value:"apache_access",title:"Apache Access"},{value:"other_vhosts",title:"Other Vhosts"},{value:"apache_error",title:"Apache Error"},{value:"mail",title:"Mail"},{value:"mysql",title:"MySQL"},{value:"fail2ban",title:"Fail2ban"},{value:"letsencrypt",title:"Let's Encrypt"},{value:"serverstatus",title:"Server Status"}],log:"",logContent:"",filter:""}},created(){this.serverId=this.$route.params.id,this.fetchData();var e=this;window.onhashchange=async function(){var t=location.hash.substr(1);if(t){var r=t,a=1;if(-1!==r.indexOf(":")){var l=r.split(":");r=l[0],a=l[1]}e.fecthing=!0,await e.$refs.editFile.open({id:r,name:r}),e.$refs.editFile.goToLine(a),location.hash=""}}},computed:{filteredLog:function(){const e=/(\/(var|etc)[^\s:\\']+( on line [0-9]+))/g,t=RegExp(`(${this.filter})*`,"gi");var r=this.logContent.split("\n");return r.filter((e=>e.toLowerCase().includes(this.filter.toLowerCase()))).join("\n").replace(t,'<span class="match">$1</span>').replace(e,'<a href="'+location.pathname+'#$1">$1</a>').replace(/( on line )([0-9]+)/g,":$2").replace(/(PHP Fatal error)/g,'<span class="error">$1</span>').replace(/(PHP Parse error)/g,'<span class="error">$1</span>').replace(/(PHP Warning)/g,'<span class="warning">$1</span>')}},methods:{fetchData(){var e=this;this.error="",this.fetching=!0,i.Z.get("servers/"+this.serverId).then((function(t){if(console.log(t),t.data.error)return e.error=t.data.error,!1;e.data=t.data.item,document.title="Logs | "+e.data.name})).catch((function(e){console.log(e)})).finally((function(){e.fetching=!1}))},fetchLog(e){var t=this;if(this.fetching=!0,e)t.log=e;else if(!t.log)return;this.logContent="loading..",i.Z.post("servers/"+this.serverId+"/fetchlog",{log:t.log}).then((function(e){console.log(e),t.logContent=e.data.content})).finally((function(){t.fetching=!1}))},handleError(e){this.error=e},handleLoading(e){this.fetching=e}}},d=r(48118);const h=(0,d.Z)(u,[["render",s]]);var f=h}}]);
//# sourceMappingURL=5408.c5be434c.js.map